{"ast":null,"code":"/*\r\nCopyright 2022 Adobe\r\nAll Rights Reserved.\r\n\r\nNOTICE: Adobe permits you to use, modify, and distribute this file in\r\naccordance with the terms of the Adobe license agreement accompanying\r\nit.\r\n*/\n\nimport { useEffect, useState } from \"react\";\nimport aemHeadlessClient from \"./aemHeadlessClient\";\n\n/**\r\n * This file contains the React useEffect custom hooks that:\r\n * 1. Are called by the React components\r\n * 2. To get data from AEM GraphQL persisted queries\r\n *\r\n * Each custom hook maps to a persisted query and is responsible for:\r\n * 1. Calling the AEM persisted query\r\n * 2. Collecting and transforming the returned data into the format expected by the React view components\r\n * 3. Setting and returning any error state\r\n */\n\n/**\r\n * Private, shared function that invokes the AEM Headless client.\r\n * \r\n * @param {String} persistedQueryName the fully qualified name of the persisted query\r\n * @param {*} queryParameters an optional JavaScript object containing query parameters\r\n * @returns the GraphQL data or an error message \r\n */\nasync function fetchPersistedQuery(persistedQueryName, queryParameters) {\n  let data;\n  let err;\n  try {\n    // AEM GraphQL queries are asynchronous, either await their return or use Promise-based .then(..) { ... } syntax\n    const response = await aemHeadlessClient.runPersistedQuery(persistedQueryName, queryParameters);\n    // The GraphQL data is stored on the response's data field\n    data = response === null || response === void 0 ? void 0 : response.data;\n  } catch (e) {\n    var _e$toJSON, _e$toJSON$map;\n    // An error occurred, return the error messages\n    err = (_e$toJSON = e.toJSON()) === null || _e$toJSON === void 0 ? void 0 : (_e$toJSON$map = _e$toJSON.map(error => error.message)) === null || _e$toJSON$map === void 0 ? void 0 : _e$toJSON$map.join(\", \");\n    console.error(e.toJSON());\n  }\n  return {\n    data,\n    err\n  };\n}\n\n/**\r\n * React custom hook that returns a list of adevntures by activity. If no activity is provided, all adventures are returned.\r\n * \r\n * Custom hook that calls the 'wknd-shared/adventures-all' or 'wknd-shared/adventures-by-activity' persisted query.\r\n *\r\n * @returns an array of Adventure JSON objects, and array of errors\r\n */\nexport function useAdventuresByActivity(adventureActivity) {\n  const [adventures, setAdventures] = useState(null);\n  const [errors, setErrors] = useState(null);\n\n  // Use React useEffect to manage state changes\n  useEffect(() => {\n    async function fetchData() {\n      var _response$data, _response$data$advent;\n      let response;\n\n      // if an activity is set (i.e \"Camping\", \"Hiking\"...) call wknd-shared/adventures-by-activity query\n      if (adventureActivity) {\n        // The key is 'activity' as defined in the persisted query\n        const queryParameters = {\n          activity: adventureActivity\n        };\n\n        // Call the AEM GraphQL persisted query named \"wknd-shared/adventures-by-activity\" with parameters\n        response = await fetchPersistedQuery(\"wknd-shared/adventures-by-activity\", queryParameters);\n      } else {\n        // Call the AEM GraphQL persisted query named \"wknd-shared/adventures-all\"\n        response = await fetchPersistedQuery(\"wknd-shared/adventures-all\");\n      }\n\n      // Sets the adventures variable to the list of adventure JSON objects\n      setAdventures((_response$data = response.data) === null || _response$data === void 0 ? void 0 : (_response$data$advent = _response$data.adventureList) === null || _response$data$advent === void 0 ? void 0 : _response$data$advent.items);\n\n      // Set any errors\n      setErrors(response.err);\n    }\n    // Call the internal fetchData() as per React best practices\n    fetchData();\n  }, [adventureActivity]);\n\n  // Returns the adventures and errors\n  return {\n    adventures,\n    errors\n  };\n}\n\n/**\r\n * Calls the 'wknd-shared/adventure-by-slug' persisted query with `slug` parameter.\r\n *\r\n * @param {String!} slugName the adventure slug\r\n * @returns a JSON object representing the Adventure\r\n */\nexport function useAdventureBySlug(slugName) {\n  const [adventure, setAdventure] = useState(null);\n  const [references, setReferences] = useState(null);\n  const [errors, setErrors] = useState(null);\n  useEffect(() => {\n    async function fetchData() {\n      var _response$data2, _response$data2$adven, _response$data2$adven2;\n      let response;\n\n      // The key is 'slug' as defined in the persisted query\n      const queryParameters = {\n        slug: slugName\n      };\n\n      // Call the AEM GraphQL persisted query named \"wknd-shared/adventure-by-slug\" with parameters\n      response = await fetchPersistedQuery(\"wknd-shared/adventure-by-slug\", queryParameters);\n      if (response.err) {\n        // Capture errors from the HTTP request\n        setErrors(response.err);\n      } else if (((_response$data2 = response.data) === null || _response$data2 === void 0 ? void 0 : (_response$data2$adven = _response$data2.adventureList) === null || _response$data2$adven === void 0 ? void 0 : (_response$data2$adven2 = _response$data2$adven.items) === null || _response$data2$adven2 === void 0 ? void 0 : _response$data2$adven2.length) === 1) {\n        // Set the Adventure data after data validation\n        setAdventure(response.data.adventureList.items[0]);\n        setReferences(response.data.adventureList._references);\n      } else {\n        // Set an error if no Adventure could be found\n        setErrors(`Cannot find Adventure with slug: ${slugName}`);\n      }\n    }\n\n    // Call the internal fetchData() as per React best practices\n    fetchData();\n  }, [slugName]);\n  return {\n    adventure,\n    references,\n    errors\n  };\n}","map":{"version":3,"names":["useEffect","useState","aemHeadlessClient","fetchPersistedQuery","persistedQueryName","queryParameters","data","err","response","runPersistedQuery","e","_e$toJSON","_e$toJSON$map","toJSON","map","error","message","join","console","useAdventuresByActivity","adventureActivity","adventures","setAdventures","errors","setErrors","fetchData","_response$data","_response$data$advent","activity","adventureList","items","useAdventureBySlug","slugName","adventure","setAdventure","references","setReferences","_response$data2","_response$data2$adven","_response$data2$adven2","slug","length","_references"],"sources":["C:/AEM-spa-tutorial/Code/aem-guides-wknd-graphql/remote-spa-tutorial/react-app/src/api/usePersistedQueries.js"],"sourcesContent":["/*\r\nCopyright 2022 Adobe\r\nAll Rights Reserved.\r\n\r\nNOTICE: Adobe permits you to use, modify, and distribute this file in\r\naccordance with the terms of the Adobe license agreement accompanying\r\nit.\r\n*/\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport aemHeadlessClient from \"./aemHeadlessClient\";\r\n\r\n/**\r\n * This file contains the React useEffect custom hooks that:\r\n * 1. Are called by the React components\r\n * 2. To get data from AEM GraphQL persisted queries\r\n *\r\n * Each custom hook maps to a persisted query and is responsible for:\r\n * 1. Calling the AEM persisted query\r\n * 2. Collecting and transforming the returned data into the format expected by the React view components\r\n * 3. Setting and returning any error state\r\n */\r\n\r\n/**\r\n * Private, shared function that invokes the AEM Headless client.\r\n * \r\n * @param {String} persistedQueryName the fully qualified name of the persisted query\r\n * @param {*} queryParameters an optional JavaScript object containing query parameters\r\n * @returns the GraphQL data or an error message \r\n */\r\nasync function fetchPersistedQuery(persistedQueryName, queryParameters) {\r\n  let data;\r\n  let err;\r\n\r\n  try {\r\n    // AEM GraphQL queries are asynchronous, either await their return or use Promise-based .then(..) { ... } syntax\r\n    const response = await aemHeadlessClient.runPersistedQuery(\r\n      persistedQueryName,\r\n      queryParameters\r\n    );\r\n    // The GraphQL data is stored on the response's data field\r\n    data = response?.data;\r\n  } catch (e) {\r\n    // An error occurred, return the error messages\r\n    err = e\r\n      .toJSON()\r\n      ?.map((error) => error.message)\r\n      ?.join(\", \");\r\n    console.error(e.toJSON());\r\n  }\r\n\r\n  return { data, err };\r\n}\r\n\r\n/**\r\n * React custom hook that returns a list of adevntures by activity. If no activity is provided, all adventures are returned.\r\n * \r\n * Custom hook that calls the 'wknd-shared/adventures-all' or 'wknd-shared/adventures-by-activity' persisted query.\r\n *\r\n * @returns an array of Adventure JSON objects, and array of errors\r\n */\r\nexport function useAdventuresByActivity(adventureActivity) {\r\n\r\n  const [adventures, setAdventures] = useState(null);\r\n  const [errors, setErrors] = useState(null);\r\n\r\n  // Use React useEffect to manage state changes\r\n  useEffect(() => {\r\n    async function fetchData() {\r\n\r\n      let response;\r\n\r\n      // if an activity is set (i.e \"Camping\", \"Hiking\"...) call wknd-shared/adventures-by-activity query\r\n      if (adventureActivity) {\r\n        // The key is 'activity' as defined in the persisted query\r\n        const queryParameters = { activity: adventureActivity };\r\n\r\n        // Call the AEM GraphQL persisted query named \"wknd-shared/adventures-by-activity\" with parameters\r\n        response = await fetchPersistedQuery(\"wknd-shared/adventures-by-activity\", queryParameters);\r\n      } else {\r\n        // Call the AEM GraphQL persisted query named \"wknd-shared/adventures-all\"\r\n        response = await fetchPersistedQuery(\"wknd-shared/adventures-all\");\r\n      }\r\n\r\n      // Sets the adventures variable to the list of adventure JSON objects\r\n      setAdventures(response.data?.adventureList?.items);\r\n\r\n      // Set any errors\r\n      setErrors(response.err);\r\n    }\r\n    // Call the internal fetchData() as per React best practices\r\n    fetchData();\r\n\r\n  }, [adventureActivity]);\r\n\r\n  // Returns the adventures and errors\r\n  return { adventures, errors };\r\n}\r\n\r\n/**\r\n * Calls the 'wknd-shared/adventure-by-slug' persisted query with `slug` parameter.\r\n *\r\n * @param {String!} slugName the adventure slug\r\n * @returns a JSON object representing the Adventure\r\n */\r\nexport function useAdventureBySlug(slugName) {\r\n  const [adventure, setAdventure] = useState(null);\r\n  const [references, setReferences] = useState(null);\r\n  const [errors, setErrors] = useState(null);\r\n\r\n  useEffect(() => {\r\n    async function fetchData() {\r\n\r\n      let response;\r\n\r\n      // The key is 'slug' as defined in the persisted query\r\n      const queryParameters = { slug: slugName };\r\n\r\n      // Call the AEM GraphQL persisted query named \"wknd-shared/adventure-by-slug\" with parameters\r\n      response = await fetchPersistedQuery(\r\n        \"wknd-shared/adventure-by-slug\",\r\n        queryParameters\r\n      );\r\n\r\n      if (response.err) {\r\n        // Capture errors from the HTTP request\r\n        setErrors(response.err);\r\n      } else if (response.data?.adventureList?.items?.length === 1) {\r\n        // Set the Adventure data after data validation\r\n        setAdventure(response.data.adventureList.items[0]);\r\n        setReferences(response.data.adventureList._references);\r\n      } else {\r\n        // Set an error if no Adventure could be found\r\n        setErrors(`Cannot find Adventure with slug: ${slugName}`);\r\n      }\r\n\r\n    }\r\n\r\n    // Call the internal fetchData() as per React best practices\r\n    fetchData();\r\n\r\n  }, [slugName]);\r\n\r\n  return { adventure, references, errors };\r\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}